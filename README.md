# NRAS

The project is designed to use a collection of indicators to flag and calculate scenarios in which to decide stations that should be upgraded to a step free and accessible category (A and B1)


## Dashboard Script

This script is written and design to calculate scenario data relating to an upgrade or change in station categories allowing the user to run the code in PowerBi and view the new values in the KPIs dynamically. 

### Inputs:

`Input template.csv` - this is a csv file containing the station codes and new category label of all stations to be upgraded in a given scenario, the input template represents a scenario 

`Step Free Scoring.xlsx` - this is a workbook previously created, containing the base scores and categories for all stations, this is read in as an input to be the template for the upgraded categories/scenario 

`MOIRAOD.accdb` - the access database that is provided by NR, this provides the list of all stations, their categories and journey data, in the form of an O-D Matrix, this is read in a template for the journey data calculations 

### What the script does: 


1. The script reads in the step free scoring xlsx workbook and extracts the sheets `‘All_Stations, St_cat’` into dataframes 
```
base_df = pd.read_excel(path_of_spreadsh, sheet_name="All Stations", header=2, usecols="B:AS", engine='openpyxl')
alt_any = pd.read_excel(path_of_spreadsh, sheet_name="Alt_Any_20", header=4, usecols="B:F", engine='openpyxl')
input_df, scenario_tag = get_updated_stations()
```

2. The script then reads in the OD Matrix and the input csv; defined by the user before running, into data frames and updates the station categories by the values defined in the input csv, this is done in the fuctions below
```
def input_OD_Matrix():

def get_updated_stations():

def map_input_stations(OD_df, base_df, input_df):
```

3. The number of unlocked journeys, potential rank and connectivity rank are computed, 
```
def get_new_categories_set_jrnys(base_df, input_df):
```

4. The mobility and isolation scores including the revisited isolation scores are calculated  
```
def set_mobility_isolation_score(updated_cats_and_jrnys, alt_any_df, input_df):
```

5. All the columns after mobility score in the dataframe made from All_Stations are blanked with empty values for stations that are accessible 
```
def blanking_rows(updated_mobility_and_isolation):
```

6. The total journeys are grouped by station and are outputted to a new spreadsheet with the updated categories listed 
```
def into_stepfree_spreadsheet(final_df, grouped_origin_df, grouped_destination_df, path_of_spreadsh, scenario_tag):
```

### Outputs: 

- `New OD Matrix (PowerBi Table):` Generated by the MOIRAOD database and the input template csv, the stations reflect the upgraded stations from the csv 

- `Final DF/All Stations_sc (PowerBi Table) ` A table generated from the xlsx file and the input csv, this table contains all the stations, their categories (including upgraded), accessibility flags, connectivity and journey data, mobility data and socio-economic data scorings. 

- `Scenario Spreadsheets` Spreadsheet generated from the xlsx, input csv and the MOIRAOD file, the sheets `‘st_cat’`, `Inaccessible O Accessi D`, `Accessible O Inaccessi D` are all updated to reflect the new categories

- An output log of the calculations that occured in that single run as a txt file
